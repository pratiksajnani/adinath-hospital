<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Appointments | Adinath Hospital</title>
    <link rel="icon" type="image/svg+xml" href="../../images/favicon.svg">
    <link rel="stylesheet" href="../../css/styles.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        .portal-header { background: linear-gradient(135deg, #236b48, #236b48); color: white; padding: 20px; }
        .portal-header h1 { margin: 0; font-size: 24px; }
        .portal-nav { background: white; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; display: flex; gap: 20px; flex-wrap: wrap; }
        .portal-nav a { color: #236b48; text-decoration: none; font-weight: 500; padding: 8px 16px; border-radius: 20px; }
        .portal-nav a:hover, .portal-nav a.active { background: #e0f2f1; }
        .container { max-width: 900px; margin: 0 auto; padding: 20px; }
        .card { background: white; border-radius: 12px; padding: 20px; margin: 15px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .card-title { font-size: 18px; font-weight: 600; color: #333; }
        .status { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status.pending { background: #fef3c7; color: #b45309; }
        .status.confirmed { background: #dbeafe; color: #1d4ed8; }
        .status.completed { background: #dcfce7; color: #166534; }
        .status.cancelled { background: #fee2e2; color: #dc2626; }
        .appointment-details { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .detail-item label { display: block; font-size: 12px; color: #666; margin-bottom: 3px; }
        .detail-item span { font-weight: 500; color: #333; }
        .btn { display: inline-block; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 600; font-size: 14px; cursor: pointer; border: none; }
        .btn-primary { background: #236b48; color: white; }
        .btn-outline { border: 2px solid #236b48; color: #236b48; background: white; }
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .empty-state .icon { font-size: 48px; margin-bottom: 15px; }
    </style>
</head>
<body>
    <div class="portal-header">
        <h1>üìÖ My Appointments</h1>
    </div>
    
    <nav class="portal-nav">
        <a href="index.html">üè† Dashboard</a>
        <a href="appointments.html" class="active">üìÖ Appointments</a>
        <a href="prescriptions.html">üíä Prescriptions</a>
        <a href="../../index.html">‚Üê Back to Website</a>
    </nav>

    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2>Your Appointments</h2>
            <a href="../../book.html" class="btn btn-primary">+ Book New</a>
        </div>

        <!-- Appointments list -->
        <div id="appointments-container">
            <!-- Loaded dynamically -->
        </div>

        <div id="empty-state" class="empty-state" style="display: none;">
            <div class="icon">üìÖ</div>
            <h3>No Appointments Yet</h3>
            <p>Book your first appointment to get started.</p>
            <a href="../../book.html" class="btn btn-primary" style="margin-top: 15px;">Book Appointment</a>
        </div>
    </div>

    <script src="../../js/config.js"></script>
    <script src="../../js/hms.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if patient is logged in
            const savedPatient = localStorage.getItem('currentPatient');
            if (!savedPatient) {
                // Redirect to patient portal login
                window.location.href = 'index.html';
                return;
            }
            
            const currentPatient = JSON.parse(savedPatient);
            
            // Load appointments from HMS
            const appointments = HMS.appointments.getByPatient(currentPatient.id);
            const container = document.getElementById('appointments-container');
            const emptyState = document.getElementById('empty-state');
            
            if (appointments.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            // Sort: upcoming first, then past
            const now = new Date();
            const upcoming = appointments.filter(a => new Date(a.date) >= now);
            const past = appointments.filter(a => new Date(a.date) < now);
            
            let html = '';
            
            if (upcoming.length > 0) {
                html += '<h3 style="color: #236b48; margin-bottom: 15px;">Upcoming Appointments</h3>';
                upcoming.forEach(apt => {
                    html += renderAppointmentCard(apt, 'upcoming');
                });
            }
            
            if (past.length > 0) {
                html += '<h3 style="margin-top: 30px; color: #666;">Past Appointments</h3>';
                past.forEach(apt => {
                    html += renderAppointmentCard(apt, 'past');
                });
            }
            
            container.innerHTML = html;
        });
        
        function renderAppointmentCard(apt, type) {
            const date = new Date(apt.date);
            const dateStr = date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
            const doctorName = apt.doctor === 'ashok' ? 'Dr. Ashok Sajnani' : 'Dr. Sunita Sajnani';
            const statusClass = apt.status || (type === 'past' ? 'completed' : 'pending');
            
            return `
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">${doctorName}</span>
                        <span class="status ${statusClass}">${statusClass}</span>
                    </div>
                    <div class="appointment-details">
                        <div class="detail-item">
                            <label>Date</label>
                            <span>${dateStr}</span>
                        </div>
                        <div class="detail-item">
                            <label>Time</label>
                            <span>${apt.time || 'Not set'}</span>
                        </div>
                        <div class="detail-item">
                            <label>Reason</label>
                            <span>${apt.reason || 'General Consultation'}</span>
                        </div>
                    </div>
                    ${type === 'upcoming' ? `
                    <div style="margin-top: 15px; display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="reschedule('${apt.id}')">üîÑ Reschedule</button>
                        <button class="btn btn-outline" style="border-color: #dc2626; color: #dc2626;" onclick="cancelAppt('${apt.id}')">‚ùå Cancel</button>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function reschedule(id) {
            alert('Please call +91 99254 50425 to reschedule your appointment.');
        }

        function cancelAppt(id) {
            if (confirm('Are you sure you want to cancel this appointment?')) {
                HMS.appointments.updateStatus(id, 'cancelled');
                alert('Appointment cancelled.');
                location.reload();
            }
        }
    </script>
<script>if(typeof initFeedbackWidget==="function")initFeedbackWidget("patient");</script>
<script src="../../js/user-status.js"></script>
<script src="../../js/access-control.js"></script>
</body>
</html>
