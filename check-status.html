<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Appointment Status | Adinath Hospital</title>
    <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        body { 
            font-family: 'Segoe UI', -apple-system, sans-serif; 
            background: linear-gradient(135deg, #f0fdf4 0%, #e0f2fe 100%);
            min-height: 100vh;
            margin: 0;
        }
        
        .page-header {
            background: linear-gradient(135deg, #0d9488, #0f766e);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .page-header h1 { 
            margin: 0 0 8px 0;
            font-size: 28px;
        }
        
        .page-header p {
            margin: 0;
            opacity: 0.9;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .lookup-card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin-top: -30px;
            position: relative;
            z-index: 1;
        }
        
        .lookup-card h2 {
            margin: 0 0 20px 0;
            text-align: center;
            color: #1e293b;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            box-sizing: border-box;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #0d9488;
        }
        
        .btn {
            display: inline-block;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #0d9488, #0f766e);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }
        
        .results-section {
            margin-top: 30px;
            display: none;
        }
        
        .results-section.show {
            display: block;
        }
        
        .appointment-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-left: 4px solid #0d9488;
        }
        
        .appointment-card.completed {
            border-left-color: #22c55e;
        }
        
        .appointment-card.cancelled {
            border-left-color: #ef4444;
        }
        
        .appointment-card.pending {
            border-left-color: #f59e0b;
        }
        
        .appt-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .appt-doctor {
            font-weight: 600;
            color: #1e293b;
            font-size: 16px;
        }
        
        .appt-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .appt-status.confirmed { background: #dcfce7; color: #166534; }
        .appt-status.pending { background: #fef3c7; color: #92400e; }
        .appt-status.completed { background: #e0e7ff; color: #3730a3; }
        .appt-status.cancelled { background: #fee2e2; color: #991b1b; }
        
        .appt-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .appt-detail {
            font-size: 14px;
        }
        
        .appt-detail label {
            display: block;
            color: #6b7280;
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        .appt-detail span {
            color: #1e293b;
            font-weight: 500;
        }
        
        .appt-actions {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #f3f4f6;
            display: flex;
            gap: 10px;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 8px;
        }
        
        .btn-outline {
            background: white;
            border: 2px solid #0d9488;
            color: #0d9488;
        }
        
        .btn-whatsapp {
            background: #25d366;
            color: white;
        }
        
        .no-results {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
        }
        
        .no-results .icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .back-link {
            display: block;
            text-align: center;
            margin-top: 30px;
            color: #0d9488;
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .language-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .lang-btn.active {
            background: #0d9488;
            color: white;
            border-color: #0d9488;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        
        .loading .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid #e5e7eb;
            border-top-color: #0d9488;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .help-text {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: #f0fdf4;
            border-radius: 10px;
            font-size: 14px;
            color: #166534;
        }
        
        @media (max-width: 600px) {
            .appt-details {
                grid-template-columns: 1fr;
            }
            .appt-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header class="page-header">
        <h1>üìã Check Appointment Status</h1>
        <p>Enter your phone number to view your appointments</p>
    </header>
    
    <div class="container">
        <div class="lookup-card">
            <div class="language-bar">
                <button class="lang-btn active" onclick="setLang('en')">English</button>
                <button class="lang-btn" onclick="setLang('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
                <button class="lang-btn" onclick="setLang('gu')">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä</button>
            </div>
            
            <h2 data-i18n="lookup_title">Find Your Appointments</h2>
            
            <form id="lookupForm">
                <div class="form-group">
                    <label data-i18n="phone_label">Phone Number</label>
                    <input type="tel" id="phoneInput" placeholder="Enter 10-digit phone number" 
                           pattern="[0-9]{10}" maxlength="10" required>
                </div>
                
                <button type="submit" class="btn btn-primary" data-i18n="search_btn">
                    üîç Find Appointments
                </button>
            </form>
            
            <div class="help-text">
                <span data-i18n="help_text">Enter the phone number you used while booking your appointment.</span>
            </div>
        </div>
        
        <!-- Loading -->
        <div id="loadingState" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p data-i18n="searching">Searching...</p>
        </div>
        
        <!-- Results Section -->
        <div id="resultsSection" class="results-section">
            <h3 style="margin-bottom: 15px; color: #374151;" data-i18n="your_appointments">Your Appointments</h3>
            <div id="appointmentsList"></div>
        </div>
        
        <!-- No Results -->
        <div id="noResults" class="no-results" style="display: none;">
            <div class="icon">üìÖ</div>
            <h3 data-i18n="no_appts">No Appointments Found</h3>
            <p data-i18n="no_appts_msg">We couldn't find any appointments with this phone number.</p>
            <a href="book.html" class="btn btn-primary" style="margin-top: 15px; display: inline-block;" data-i18n="book_new">
                üìÖ Book New Appointment
            </a>
        </div>
        
        <a href="index.html" class="back-link">‚Üê Back to Homepage</a>
    </div>
    
    <script src="js/config.js"></script>
    <script src="js/hms.js"></script>
    <script src="js/i18n.js"></script>
    <script>
        const translations = {
            en: {
                lookup_title: 'Find Your Appointments',
                phone_label: 'Phone Number',
                search_btn: 'üîç Find Appointments',
                help_text: 'Enter the phone number you used while booking your appointment.',
                searching: 'Searching...',
                your_appointments: 'Your Appointments',
                no_appts: 'No Appointments Found',
                no_appts_msg: "We couldn't find any appointments with this phone number.",
                book_new: 'üìÖ Book New Appointment',
                date: 'Date',
                time: 'Time',
                doctor: 'Doctor',
                reason: 'Reason',
                status_confirmed: 'Confirmed',
                status_pending: 'Pending',
                status_completed: 'Completed',
                status_cancelled: 'Cancelled',
                reschedule: 'üîÑ Reschedule',
                whatsapp_help: 'üí¨ Need Help?'
            },
            hi: {
                lookup_title: '‡§Ö‡§™‡§®‡•Ä ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                phone_label: '‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞',
                search_btn: 'üîç ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§ñ‡•ã‡§ú‡•á‡§Ç',
                help_text: '‡§µ‡§π ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç ‡§ú‡•ã ‡§Ü‡§™‡§®‡•á ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§¨‡•Å‡§ï ‡§ï‡§∞‡§§‡•á ‡§∏‡§Æ‡§Ø ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§ø‡§Ø‡§æ ‡§•‡§æ‡•§',
                searching: '‡§ñ‡•ã‡§ú ‡§∞‡§π‡•á ‡§π‡•à‡§Ç...',
                your_appointments: '‡§Ü‡§™‡§ï‡•Ä ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü‡•ç‡§∏',
                no_appts: '‡§ï‡•ã‡§à ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä',
                no_appts_msg: '‡§á‡§∏ ‡§´‡§º‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§∏‡•á ‡§ï‡•ã‡§à ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•Ä‡•§',
                book_new: 'üìÖ ‡§®‡§à ‡§Ö‡§™‡•â‡§á‡§Ç‡§ü‡§Æ‡•á‡§Ç‡§ü ‡§¨‡•Å‡§ï ‡§ï‡§∞‡•á‡§Ç',
                date: '‡§§‡§æ‡§∞‡•Ä‡§ñ',
                time: '‡§∏‡§Æ‡§Ø',
                doctor: '‡§°‡•â‡§ï‡•ç‡§ü‡§∞',
                reason: '‡§ï‡§æ‡§∞‡§£',
                status_confirmed: '‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§π‡•ã ‡§ó‡§à',
                status_pending: '‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ‡§∞‡§§',
                status_completed: '‡§™‡•Ç‡§∞‡•ç‡§£',
                status_cancelled: '‡§∞‡§¶‡•ç‡§¶',
                reschedule: 'üîÑ ‡§™‡•Å‡§®‡§∞‡•ç‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
                whatsapp_help: 'üí¨ ‡§Æ‡§¶‡§¶ ‡§ö‡§æ‡§π‡§ø‡§è?'
            },
            gu: {
                lookup_title: '‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™∂‡´ã‡™ß‡´ã',
                phone_label: '‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞',
                search_btn: 'üîç ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™∂‡´ã‡™ß‡´ã',
                help_text: '‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™¨‡´Å‡™ï ‡™ï‡™∞‡™§‡´Ä ‡™µ‡™ñ‡™§‡´á ‡™µ‡™æ‡™™‡™∞‡´á‡™≤‡´ã ‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã.',
                searching: '‡™∂‡´ã‡™ß‡´Ä ‡™∞‡™π‡´ç‡™Ø‡™æ ‡™õ‡´Ä‡™è...',
                your_appointments: '‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü‡´ç‡™∏',
                no_appts: '‡™ï‡´ã‡™à ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™Æ‡™≥‡´Ä ‡™®‡™•‡´Ä',
                no_appts_msg: '‡™Ü ‡™´‡´ã‡™® ‡™®‡™Ç‡™¨‡™∞ ‡™∏‡™æ‡™•‡´á ‡™ï‡´ã‡™à ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™Æ‡™≥‡´Ä ‡™®‡™•‡´Ä.',
                book_new: 'üìÖ ‡™®‡™µ‡´Ä ‡™è‡™™‡´ã‡™á‡™®‡´ç‡™ü‡™Æ‡´á‡™®‡´ç‡™ü ‡™¨‡´Å‡™ï ‡™ï‡™∞‡´ã',
                date: '‡™§‡™æ‡™∞‡´Ä‡™ñ',
                time: '‡™∏‡™Æ‡™Ø',
                doctor: '‡™°‡´â‡™ï‡´ç‡™ü‡™∞',
                reason: '‡™ï‡™æ‡™∞‡™£',
                status_confirmed: '‡™™‡´Å‡™∑‡´ç‡™ü‡™ø ‡™•‡™à',
                status_pending: '‡™¨‡™æ‡™ï‡´Ä',
                status_completed: '‡™™‡´Ç‡™∞‡´ç‡™£',
                status_cancelled: '‡™∞‡™¶',
                reschedule: 'üîÑ ‡™´‡™∞‡´Ä ‡™∂‡´á‡™°‡´ç‡™Ø‡´Ç‡™≤ ‡™ï‡™∞‡´ã',
                whatsapp_help: 'üí¨ ‡™Æ‡™¶‡™¶ ‡™ú‡´ã‡™à‡™è?'
            }
        };
        
        let currentLang = 'en';
        
        function setLang(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(
                    lang === 'en' ? 'English' : lang === 'hi' ? '‡§π‡§ø‡§Ç‡§¶‡•Ä' : '‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä'
                ));
            });
            
            // Update all text
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
        }
        
        function t(key) {
            return translations[currentLang][key] || translations['en'][key] || key;
        }
        
        document.getElementById('lookupForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const phone = document.getElementById('phoneInput').value.trim();
            if (phone.length !== 10) {
                alert('Please enter a valid 10-digit phone number');
                return;
            }
            
            // Show loading
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('show');
            document.getElementById('noResults').style.display = 'none';
            
            // Simulate search delay for UX
            setTimeout(() => {
                searchAppointments(phone);
            }, 800);
        });
        
        function searchAppointments(phone) {
            document.getElementById('loadingState').style.display = 'none';
            
            // Get appointments from HMS
            const allAppointments = HMS.appointments.getAll();
            const matching = allAppointments.filter(a => 
                a.phone && a.phone.replace(/\D/g, '').includes(phone)
            );
            
            // Also check patients
            const patients = HMS.patients.getAll();
            const matchingPatient = patients.find(p => 
                p.phone && p.phone.replace(/\D/g, '').includes(phone)
            );
            
            if (matchingPatient) {
                // Get all appointments for this patient
                const patientAppts = allAppointments.filter(a => a.patientId === matchingPatient.id);
                patientAppts.forEach(a => {
                    if (!matching.find(m => m.id === a.id)) {
                        matching.push(a);
                    }
                });
            }
            
            if (matching.length === 0) {
                // Add demo appointments for testing
                if (phone === '9876543210') {
                    displayAppointments([
                        {
                            id: 'demo1',
                            doctor: 'Dr. Ashok Sajnani',
                            date: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            time: '11:30 AM',
                            reason: 'Knee Pain Consultation',
                            status: 'confirmed'
                        },
                        {
                            id: 'demo2',
                            doctor: 'Dr. Sunita Sajnani',
                            date: '2024-12-10',
                            time: '3:00 PM',
                            reason: 'Follow-up Visit',
                            status: 'completed'
                        }
                    ]);
                    return;
                }
                
                document.getElementById('noResults').style.display = 'block';
            } else {
                displayAppointments(matching);
            }
        }
        
        function displayAppointments(appointments) {
            const container = document.getElementById('appointmentsList');
            container.innerHTML = '';
            
            // Sort by date (upcoming first)
            appointments.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            appointments.forEach(appt => {
                const statusClass = appt.status || 'pending';
                const card = document.createElement('div');
                card.className = `appointment-card ${statusClass}`;
                
                const formattedDate = appt.date ? new Date(appt.date).toLocaleDateString('en-IN', {
                    weekday: 'short',
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                }) : 'TBD';
                
                card.innerHTML = `
                    <div class="appt-header">
                        <span class="appt-doctor">${appt.doctor || 'Doctor'}</span>
                        <span class="appt-status ${statusClass}">${t('status_' + statusClass)}</span>
                    </div>
                    <div class="appt-details">
                        <div class="appt-detail">
                            <label>${t('date')}</label>
                            <span>üìÖ ${formattedDate}</span>
                        </div>
                        <div class="appt-detail">
                            <label>${t('time')}</label>
                            <span>üïê ${appt.time || 'TBD'}</span>
                        </div>
                        <div class="appt-detail">
                            <label>${t('reason')}</label>
                            <span>${appt.reason || 'General Consultation'}</span>
                        </div>
                    </div>
                    <div class="appt-actions">
                        <a href="https://wa.me/919925450425?text=Hi, I need to reschedule my appointment on ${formattedDate}" 
                           class="btn btn-sm btn-outline" target="_blank">
                            ${t('reschedule')}
                        </a>
                        <a href="https://wa.me/919925450425?text=Hi, I have a question about my appointment on ${formattedDate}" 
                           class="btn btn-sm btn-whatsapp" target="_blank">
                            ${t('whatsapp_help')}
                        </a>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            document.getElementById('resultsSection').classList.add('show');
        }
        
        // Auto-focus phone input
        document.getElementById('phoneInput').focus();
    </script>
<script src="js/user-status.js"></script>
</body>
</html>

