version: 1
frontend:
    phases:
        preBuild:
            commands:
                - "echo 'Adinath Hospital - Static site deployment'"
        build:
            commands:
                - "echo 'Serving static files'"
    artifacts:
        baseDirectory: /
        files:
            - '**/*'
        discard-paths: no
        excludes:
            - 'node_modules/**/*'
            - '.git/**/*'
            - 'test-results/**/*'
            - 'coverage/**/*'
            - 'playwright-report/**/*'
            - 'tests/**/*'
            - '.husky/**/*'
            - 'scripts/**/*'
            - 'package.json'
            - 'package-lock.json'
            - 'jest.config.js'
            - 'playwright.config.js'
            - 'commitlint.config.js'
            - '.eslintrc*'
            - '.prettierrc'
            - '.editorconfig'
            - '.jscpd.json'
            - 'CONTRIBUTING.md'
            - '_redirects'
    cache:
        paths: []

customHeaders:
    - pattern: '**/*'
      headers:
          - key: X-Frame-Options
            value: SAMEORIGIN
          - key: X-Content-Type-Options
            value: nosniff
          - key: X-XSS-Protection
            value: '1; mode=block'
          - key: Referrer-Policy
            value: strict-origin-when-cross-origin
          - key: Permissions-Policy
            value: 'camera=(), microphone=(), geolocation=(self), payment=()'
          - key: Strict-Transport-Security
            value: 'max-age=31536000; includeSubDomains'
          - key: Content-Security-Policy
            value: "default-src 'self'; script-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://maps.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; frame-src https://www.google.com https://maps.google.com; connect-src 'self' https://*.supabase.co https://maps.googleapis.com"
    - pattern: '*.html'
      headers:
          - key: Cache-Control
            value: 'no-cache, no-store, must-revalidate'
    - pattern: '/images/*'
      headers:
          - key: Cache-Control
            value: 'public, max-age=31536000, immutable'
    - pattern: '/css/*'
      headers:
          - key: Cache-Control
            value: 'public, max-age=31536000, immutable'
    - pattern: '/js/*.js'
      headers:
          - key: Cache-Control
            value: 'public, max-age=86400'

customRules:
    # Onboarding pages
    - source: /onboard/admin
      target: /onboard/admin.html
      status: '200'
    - source: /onboard/admin/
      target: /onboard/admin.html
      status: '200'
    - source: '/onboard/admin/<*>'
      target: /onboard/admin.html
      status: '200'
    - source: /onboard/doctor
      target: /onboard/doctor.html
      status: '200'
    - source: /onboard/doctor/
      target: /onboard/doctor.html
      status: '200'
    - source: /onboard/staff
      target: /onboard/staff.html
      status: '200'
    - source: /onboard/staff/
      target: /onboard/staff.html
      status: '200'
    - source: /onboard/patient
      target: /onboard/patient.html
      status: '200'
    - source: /onboard/patient/
      target: /onboard/patient.html
      status: '200'
    - source: /onboard
      target: /onboard/index.html
      status: '200'
    - source: /onboard/
      target: /onboard/index.html
      status: '200'
    # Main pages
    - source: /login
      target: /login.html
      status: '200'
    - source: /book
      target: /book.html
      status: '200'
    - source: /store
      target: /store.html
      status: '200'
    - source: /check-status
      target: /check-status.html
      status: '200'
    # Portal pages
    - source: /portal
      target: /portal/index.html
      status: '200'
    - source: /portal/
      target: /portal/index.html
      status: '200'
    - source: /portal/admin
      target: /portal/admin/index.html
      status: '200'
    - source: /portal/admin/
      target: /portal/admin/index.html
      status: '200'
    - source: /portal/doctor
      target: /portal/doctor/index.html
      status: '200'
    - source: /portal/doctor/
      target: /portal/doctor/index.html
      status: '200'
    - source: /portal/staff
      target: /portal/staff/index.html
      status: '200'
    - source: /portal/staff/
      target: /portal/staff/index.html
      status: '200'
    - source: /portal/patient
      target: /portal/patient/index.html
      status: '200'
    - source: /portal/patient/
      target: /portal/patient/index.html
      status: '200'
    # SPA fallback - only for paths without file extensions
    - source: '/<*>'
      target: /index.html
      status: '404'
